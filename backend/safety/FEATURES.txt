App: safety
Project: Context-Aware AI Health Trajectory Interpreter
========================================================

PURPOSE
-------
Monitors patient health data for safety-critical conditions.
Issues alerts for dangerous values, drug interactions, and
critical risk thresholds requiring immediate attention.

FEATURES TO IMPLEMENT
----------------------

1. SAFETY ALERTS
   - GET  /api/safety/alerts/               → List all active alerts for patient/doctor
   - POST /api/safety/alerts/               → Manually create a safety alert
   - GET  /api/safety/alerts/<id>/          → Get specific alert detail
   - PUT  /api/safety/alerts/<id>/resolve/  → Mark alert as resolved

2. ALERT TYPES
   - CRITICAL_VALUE   : Lab value exceeds dangerous threshold (e.g., K+ > 6.5)
   - DRUG_INTERACTION : Detected potential dangerous drug combination
   - MISSED_FOLLOWUP  : Patient has not submitted report in X days
   - RISK_ESCALATION  : Patient risk level jumped to HIGH/CRITICAL
   - ABNORMAL_TREND   : Metric consistently worsening over 3+ reports

3. AUTOMATIC ALERT TRIGGERING
   - Triggered automatically by the analysis/risk apps after processing
   - POST /api/safety/check/  → Internal endpoint called by analysis pipeline
     Input:  { "patient_id": <id>, "report_id": <id> }
     Output: { "alerts_created": [<list of new alert IDs>] }

4. CRITICAL VALUE THRESHOLDS
   - Configurable thresholds stored in DB per metric:
     e.g., Potassium > 6.5 mmol/L → CRITICAL
           Hemoglobin < 6 g/dL    → CRITICAL
           Systolic BP > 180 mmHg → WARNING
   - GET /api/safety/thresholds/          → List all configured thresholds
   - POST /api/safety/thresholds/         → Add/update a threshold (admin only)

5. DRUG INTERACTION CHECK
   - POST /api/safety/drug-check/
     Input:  { "medications": ["Warfarin", "Aspirin", "Metformin"] }
     Output: { "interactions": [{ "drugs": [...], "severity": "HIGH", "note": "..." }] }
   - Uses a drug interaction database or external API

6. NOTIFICATION SYSTEM
   - Alert notifications sent to:
     → Assigned doctor (in-app + optional email)
     → Patient (in-app notification)
   - GET /api/safety/notifications/       → Unread safety notifications

7. MODELS
   - SafetyAlert
     Fields: patient (FK), report (FK, optional), alert_type, severity,
             message, is_resolved, resolved_by, created_at, resolved_at
   - CriticalThreshold
     Fields: metric_name, operator, threshold_value, unit, severity, description
   - DrugInteraction
     Fields: drug_a, drug_b, severity, description, source

NOTES
------
- Safety alerts are highest-priority notifications in the system
- CRITICAL alerts should be surfaced immediately in doctor's dashboard
- Keep audit log of all resolved alerts (who resolved + timestamp)
- Drug interaction check can use OpenFDA API or a local lookup table
