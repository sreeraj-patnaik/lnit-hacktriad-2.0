{% extends "base.html" %}
{% block title %}Dashboard | Aarogya Health Command{% endblock %}
{% block page_class %}dashboard-page{% endblock %}
{% block content %}
<section class="hero-shell">
    <div>
        <p class="kicker">Patient Operations</p>
        <h1>Welcome back, {{ request.user.username }}.</h1>
        <p class="lead">Track current report quality, marker alerts, and longitudinal AI interpretation in a single workspace.</p>
        <div class="cta-row">
            <a href="{% url 'report-upload' %}" class="btn btn-primary">Upload New Report</a>
            <a href="{% url 'profile' %}" class="btn btn-outline">Update Profile</a>
        </div>
    </div>
    <aside class="hero-stat">
        <h3>Patient Profile</h3>
        <ul class="metric-list">
            <li><span>Age</span><strong>{{ profile.age|default:"Not set" }}</strong></li>
            <li><span>City</span><strong>{{ profile.city|default:"Not set" }}</strong></li>
            <li><span>Goal</span><strong>{{ profile.health_goal|default:"Not set" }}</strong></li>
        </ul>
    </aside>
</section>

<section class="kpi-grid">
    <article class="kpi-card"><p>Total Reports</p><h2>{{ stats.total_reports }}</h2></article>
    <article class="kpi-card"><p>Analyses Completed</p><h2>{{ stats.completed_reports }}</h2></article>
    <article class="kpi-card risk-high"><p>High-Risk Markers</p><h2>{{ stats.flagged_high }}</h2></article>
    <article class="kpi-card risk-low"><p>Low-Risk Markers</p><h2>{{ stats.flagged_low }}</h2></article>
</section>

<section class="ops-grid">
    <article class="panel">
        <div class="panel-head">
            <h3>Report Timeline</h3>
            <p>Full history with quality and risk status.</p>
        </div>
        {% if report_rows %}
            <div class="table-wrap">
                <table class="report-table">
                    <thead>
                    <tr>
                        <th>Date</th>
                        <th>Source</th>
                        <th>Status</th>
                        <th>Risk</th>
                        <th>Coverage</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for row in report_rows %}
                        <tr>
                            <td>{{ row.report.report_date }}</td>
                            <td>{% if row.report.report_file %}<a href="{{ row.report.report_file.url }}" target="_blank">Uploaded File</a>{% else %}Text Input{% endif %}</td>
                            <td>{% if row.report.analysis_completed %}<span class="tag success">Analyzed</span>{% else %}<span class="tag neutral">Pending</span>{% endif %}</td>
                            <td>
                                {% if row.high_count %}<span class="tag danger">{{ row.high_count }} high</span>{% endif %}
                                {% if row.low_count %}<span class="tag warning">{{ row.low_count }} low</span>{% endif %}
                                {% if not row.high_count and not row.low_count %}<span class="tag success">No red flags</span>{% endif %}
                            </td>
                            <td>{{ row.parameter_count }} markers | {{ row.normal_count }} normal</td>
                            <td><a class="inline-link" href="{% url 'report-detail' row.report.id %}">Open</a></td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p class="empty-state">No reports uploaded yet. Start with your first report.</p>
        {% endif %}
    </article>

    <aside class="panel compact-panel">
        <div class="panel-head">
            <h3>Action Center</h3>
            <p>Recommended next actions for quality output.</p>
        </div>
        <ul class="action-list">
            <li>Use clear report scans with visible values and ranges.</li>
            <li>Keep profile context updated for stronger interpretation.</li>
            <li>Review flagged markers before your next consultation.</li>
            <li>Use translated narrative for family communication.</li>
        </ul>
    </aside>
</section>
{% endblock %}
